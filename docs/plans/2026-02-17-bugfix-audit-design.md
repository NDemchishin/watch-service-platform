# –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞—É–¥–∏—Ç –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ watch-service-platform

**–î–∞—Ç–∞:** 2026-02-17
**–°—Ç–∞—Ç—É—Å:** –£—Ç–≤–µ—Ä–∂–¥—ë–Ω

---

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

–ü—Ä–æ–≤–µ–¥—ë–Ω –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –ø—Ä–æ–µ–∫—Ç–∞ watch-service-platform (Telegram-–±–æ—Ç + FastAPI backend –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ —á–∞—Å–æ–≤–æ–π –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π). –ù–∞–π–¥–µ–Ω–æ ~70 –ø—Ä–æ–±–ª–µ–º –≤ 4 –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö. –¶–µ–ª—å ‚Äî –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è, –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –≤ CONVENTIONS.md –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ä–µ–≥—Ä–µ—Å—Å–∏–π.

---

## –°–µ–∫—Ü–∏—è 1: UX –±–æ—Ç–∞ (~25 –±–∞–≥–æ–≤)

### 1.1 –ù–∞–≤–∏–≥–∞—Ü–∏—è "–ù–∞–∑–∞–¥" (15 –±–∞–≥–æ–≤)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –≤–æ –í–°–ï–• flow (master, polishing, otk, urgent, history, employees) –≤–µ–¥—ë—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∏–ª–∏ –Ω–∞ –Ω–∞—á–∞–ª–æ flow, –∞ –Ω–µ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —à–∞–≥. –í `employees.py` –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è "–ù–∞–∑–∞–¥" –∏ "–í –º–µ–Ω—é" ‚Äî –∏–∑–±—ã—Ç–æ—á–Ω–æ. –í `urgent.py:53` –ø–æ—Å–ª–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ä–æ—á–Ω–æ–π –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ "–ù–∞–∑–∞–¥" –≤–µ–¥—ë—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é, –∞ –Ω–µ –≤ —Å–ø–∏—Å–æ–∫ —Å—Ä–æ—á–Ω—ã—Ö.

**–†–µ—à–µ–Ω–∏–µ: –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–π —Å—Ç–µ–∫ –≤ FSM data.**

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —à–∞–≥ –≤ `nav_history`:

```python
# –ü—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ ‚Äî push –≤ —Å—Ç–µ–∫
data = await state.get_data()
history = data.get("nav_history", [])
history.append({"state": current_state, "handler": "handler_name"})
await state.update_data(nav_history=history)

# –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ù–∞–∑–∞–¥" ‚Äî pop –∏–∑ —Å—Ç–µ–∫–∞
history = data.get("nav_history", [])
if history:
    prev = history.pop()
    await state.update_data(nav_history=history)
    # –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —à–∞–≥—É
else:
    # —Å—Ç–µ–∫ –ø—É—Å—Ç ‚Äî –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
```

### 1.2 –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å" –¥–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (3 –±–∞–≥–∞)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `polishing.py:191-203` ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ "-". –ù–µ—Ç –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
- `history.py:405-428` ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, —Ö–æ—Ç—è –ø–æ –ª–æ–≥–∏–∫–µ –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω
- –ù–µ—Ç –µ–¥–∏–Ω–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –¥–ª—è optional fields

**–†–µ—à–µ–Ω–∏–µ: –µ–¥–∏–Ω—ã–π —Ö–µ–ª–ø–µ—Ä `get_optional_input_keyboard`.**

```python
def get_optional_input_keyboard(field: str, back_to: str) -> InlineKeyboardMarkup:
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="‚è≠ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å", callback_data=f"skip:{field}")],
        [InlineKeyboardButton(text="‚¨Ö –ù–∞–∑–∞–¥", callback_data=f"back:{back_to}"),
         InlineKeyboardButton(text="üè† –í –º–µ–Ω—é", callback_data="back:main")]
    ])
```

### 1.3 –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è –¥–µ—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (4 –±–∞–≥–∞)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `employees.py:262-308` ‚Äî –∞–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- `urgent.py:220-262` ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω–∞ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- `otk.py:391` ‚Äî –≤ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ID –≤–∏–Ω–æ–≤–Ω–æ–≥–æ –≤–º–µ—Å—Ç–æ –∏–º–µ–Ω–∏

**–†–µ—à–µ–Ω–∏–µ:** –¥–≤—É—Ö—à–∞–≥–æ–≤–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
```
"–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤? –û–Ω –Ω–µ —Å–º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –∑–∞–¥–∞—á–∏."
[–î–∞, –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å] [–û—Ç–º–µ–Ω–∞]
```

### 1.4 –ó–∞—Å—Ç—Ä—è–≤—à–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (3 –±–∞–≥–∞)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `urgent.py:261` ‚Äî `state.clear()` –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–µ—Ä—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å
- `history.py:299` ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ
- –ù–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ `/cancel` —Ö–µ–Ω–¥–ª–µ—Ä–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –ì–ª–æ–±–∞–ª—å–Ω—ã–π `/cancel` —Å `StateFilter("*")`
- –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî –Ω–µ `state.clear()`, –∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
- Middleware –¥–ª—è –æ—Ç–ª–æ–≤–∞ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π —Å –∫–Ω–æ–ø–∫–æ–π "–í –º–µ–Ω—é"

---

## –°–µ–∫—Ü–∏—è 2: Backend ‚Äî –ª–æ–≥–∏–∫–∞ –∏ –¥–∞–Ω–Ω—ã–µ (~20 –±–∞–≥–æ–≤)

### 2.1 –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (5 –±–∞–≥–æ–≤)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ –µ–¥–∏–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
- `receipt_service.py:98,132` ‚Äî –¥–µ–¥–ª–∞–π–Ω –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –¥–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–π
- `operation_service.py:73-105` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ + –º–∞—Å—Ç–µ—Ä + –∏—Å—Ç–æ—Ä–∏—è ‚Äî 3 —à–∞–≥–∞ –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `return_service.py:67-125` ‚Äî –≤–æ–∑–≤—Ä–∞—Ç + –ø—Ä–∏—á–∏–Ω—ã + –∏—Å—Ç–æ—Ä–∏—è ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ
- `polishing_service.py:58-104` ‚Äî –ø–æ–ª–∏—Ä–æ–≤–∫–∞ + –∏—Å—Ç–æ—Ä–∏—è ‚Äî –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `notification_service.py:61-77` ‚Äî cancel –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:** –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ `get_db()`, —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `flush()`:

```python
def get_db():
    db = SessionLocal()
    try:
        yield db
        db.commit()
    except Exception:
        db.rollback()
        raise
    finally:
        db.close()
```

### 2.2 –í–∞–ª–∏–¥–∞—Ü–∏—è (6 –±–∞–≥–æ–≤)

- `receipts.py:166-189` ‚Äî –¥–µ–¥–ª–∞–π–Ω –≤ –ø—Ä–æ—à–ª–æ–º
- `employee_service.py:59-70` ‚Äî –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ IntegrityError –¥–ª—è telegram_id
- `polishing_service.py` ‚Äî polisher_id –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è
- `operation_service.py:83-85` ‚Äî operation_type_id, employee_id –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è
- `return_service.py:93-98` ‚Äî guilty_employee_id, reason_id –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è
- `polishing.py:104-128` ‚Äî returned_at –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ sent_at

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ FK –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º, –æ–±—Ä–∞–±–æ—Ç–∫–∞ IntegrityError, –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç.

### 2.3 Race conditions (4 –±–∞–≥–∞)

- `receipt_service.py:73-76` ‚Äî check-then-insert –¥–ª—è receipt_number
- `polishing_service.py:65-68` ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è polishing
- `polishing_service.py:114-119` ‚Äî mark_returned –Ω–µ–∞—Ç–æ–º–∞—Ä–Ω–æ
- `receipt_service.py:117,136-140` ‚Äî –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:** –õ–æ–≤–∏—Ç—å IntegrityError –≤–º–µ—Å—Ç–æ check-then-insert, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SELECT ... FOR UPDATE` –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

### 2.4 –ü–∞–≥–∏–Ω–∞—Ü–∏—è (5 –±–∞–≥–æ–≤)

- `operations.py:65-74`, `returns.py:65-74` ‚Äî –±–µ–∑ skip/limit
- `analytics_service.py:288-315` ‚Äî –≥—Ä—É–∑–∏—Ç –í–°–ï –∑–∞–ø–∏—Å–∏
- `receipts.py:38-41` ‚Äî total —Å—á–∏—Ç–∞–µ—Ç –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω—ã–µ, –∞ –Ω–µ –≤—Å–µ
- history –∏–º–µ–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é, –∞ operations/returns ‚Äî –Ω–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:** –ï–¥–∏–Ω—ã–π `PaginatedResponse[T]` —Å `total = SELECT COUNT(*)`.

---

## –°–µ–∫—Ü–∏—è 3: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (~10 –±–∞–≥–æ–≤)

### 3.1 –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (CRITICAL)

- –í–°–ï —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø—É–±–ª–∏—á–Ω—ã
- `security.py` –ø—É—Å—Ç
- Telegram webhook –±–µ–∑ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∏

**–†–µ—à–µ–Ω–∏–µ:** API Key —á–µ—Ä–µ–∑ `X-API-Key` header + `Depends(verify_api_key)` –Ω–∞ —Ä–æ—É—Ç–µ—Ä–∞—Ö. Webhook secret —á–µ—Ä–µ–∑ `X-Telegram-Bot-Api-Secret-Token`.

### 3.2 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (HIGH)

- CORS `allow_origins=["*"]`
- –î–µ—Ñ–æ–ª—Ç–Ω—ã–π DATABASE_URL —Å –∫—Ä–µ–¥–∞–º–∏
- BOT_TOKEN –º–æ–∂–µ—Ç –ø–æ–ø–∞—Å—Ç—å –≤ –ª–æ–≥–∏
- DEBUG=True –≤–∫–ª—é—á–∞–µ—Ç SQL echo

**–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç—ã –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤, –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å CORS, –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã.

### 3.3 SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –ë–ï–ó–û–ü–ê–°–ù–û.** –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ ORM —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–µ–π. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –≤ CONVENTIONS.md.

---

## –°–µ–∫—Ü–∏—è 4: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ DX (~15 –±–∞–≥–æ–≤)

### 4.1 Dead code (4 –±–∞–≥–∞)

- `security.py` ‚Äî –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª
- `PolishingDetailsUpdate` ‚Äî –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è —Å—Ö–µ–º–∞
- telegram router ‚Äî –¥–≤–æ–π–Ω–æ–π –∏–º–ø–æ—Ä—Ç
- `ReceiptUpdate.current_deadline` vs `Receipt.deadline` ‚Äî naming mismatch

### 4.2 Datetime/Timezone (3 –±–∞–≥–∞)

**–†–µ—à–µ–Ω–∏–µ: –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è –≤–µ–∑–¥–µ.**

```python
# config.py
from zoneinfo import ZoneInfo
MOSCOW_TZ = ZoneInfo("Europe/Moscow")

# core/utils.py
def now_moscow() -> datetime:
    return datetime.now(MOSCOW_TZ)

# –ú–æ–¥–µ–ª–∏
created_at = Column(DateTime(timezone=True), default=lambda: now_moscow())

# PostgreSQL
ALTER DATABASE watch_service SET timezone = 'Europe/Moscow';

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
def format_datetime(dt: datetime) -> str:
    return dt.astimezone(MOSCOW_TZ).strftime("%d.%m.%Y %H:%M")
```

–ü—Ä–∏–Ω—Ü–∏–ø: —Ö—Ä–∞–Ω–∏—Ç—å timezone-aware datetime (Europe/Moscow), –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π `format_datetime()`. –ù–∏–∫–∞–∫–∏—Ö `utcnow()`, –Ω–∏–∫–∞–∫–∏—Ö –Ω–∞–∏–≤–Ω—ã—Ö datetime.

### 4.3 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (3 –±–∞–≥–∞)

- `analytics_service.py:320-349` ‚Äî N+1 –∑–∞–ø—Ä–æ—Å ‚Üí –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –æ–¥–∏–Ω GROUP BY
- –ù–µ—Ç connection pooling ‚Üí –¥–æ–±–∞–≤–∏—Ç—å pool_size, pool_pre_ping
- –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ FK ‚Üí –¥–æ–±–∞–≤–∏—Ç—å

### 4.4 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (5 –±–∞–≥–æ–≤)

- –ù–µ—Ç logging ‚Üí –¥–æ–±–∞–≤–∏—Ç—å `logger = logging.getLogger(__name__)` –≤ –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å
- –ù–µ—Ç health check —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ë–î
- –ù–µ—Ç global exception handler
- –ù–µ—Ç request/response logging middleware
- –ë–æ—Ç –Ω–∞ MemoryStorage ‚Üí –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ Redis FSM storage

---

## –§–æ—Ä–º–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

4 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è AI-–∞–≥–µ–Ω—Ç–∞, –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:

1. **–ü—Ä–æ–º–ø—Ç 1: UX –±–æ—Ç–∞** ‚Äî –Ω–∞–≤–∏–≥–∞—Ü–∏—è, skip-–∫–Ω–æ–ø–∫–∏, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, —Å–æ—Å—Ç–æ—è–Ω–∏—è
2. **–ü—Ä–æ–º–ø—Ç 2: Backend –ª–æ–≥–∏–∫–∞** ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –ø–∞–≥–∏–Ω–∞—Ü–∏—è, race conditions
3. **–ü—Ä–æ–º–ø—Ç 3: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, CORS, —Å–µ–∫—Ä–µ—Ç—ã, webhook
4. **–ü—Ä–æ–º–ø—Ç 4: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞** ‚Äî dead code, datetime/Moscow TZ, N+1, logging, Redis FSM

–ö–∞–∂–¥—ã–π –ø—Ä–æ–º–ø—Ç —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ.

---

## –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

- `CONVENTIONS.md` ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—â–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏
- 4 –ø—Ä–æ–º–ø—Ç–∞ –≤ `docs/plans/prompts/`
